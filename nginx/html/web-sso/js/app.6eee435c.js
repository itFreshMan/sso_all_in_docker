(function(e){function t(t){for(var n,o,s=t[0],c=t[1],u=t[2],l=0,d=[];l<s.length;l++)o=s[l],a[o]&&d.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);p&&p(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var s=r[o];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},o={app:0},a={app:0},i=[];function s(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-76d1ddf1":"0ead2746"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(e){var t=[],r={"chunk-76d1ddf1":1};o[e]?t.push(o[e]):0!==o[e]&&r[e]&&t.push(o[e]=new Promise(function(t,r){for(var n="css/"+({}[e]||e)+"."+{"chunk-76d1ddf1":"a10aaf4c"}[e]+".css",a=c.p+n,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var u=i[s],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===n||l===a))return t()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){u=d[s],l=u.getAttribute("data-href");if(l===n||l===a)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||a,i=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=n,delete o[e],p.parentNode.removeChild(p),r(i)},p.href=a;var f=document.getElementsByTagName("head")[0];f.appendChild(p)}).then(function(){o[e]=0}));var n=a[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise(function(t,r){n=a[e]=[t,r]});t.push(n[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=s(e),u=function(t){l.onerror=l.onload=null,clearTimeout(d);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+n+": "+o+")");i.type=n,i.request=o,r[1](i)}a[e]=void 0}};var d=setTimeout(function(){u({type:"timeout",target:l})},12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/web-sso/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var p=l;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("64a9"),o=r.n(n);o.a},"349f":function(e,t,r){},"3ccf":function(e,t,r){"use strict";var n=r("349f"),o=r.n(n);o.a},"3f77":function(e,t,r){e.exports=r.p+"img/icon_404.3023c63f.png"},5052:function(e,t,r){e.exports=r.p+"img/icon_403.63b620c9.png"},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view")],1)},a=[],i=(r("034f"),r("2877")),s={},c=Object(i["a"])(s,o,a,!1,null,null,null),u=c.exports,l=r("8c4f"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"error-body clearfix"},["403"===e.errorCode?n("div",[n("img",{attrs:{src:r("5052"),alt:""}}),n("p",{staticClass:"fs22"},[e._v("对不起，您没有该页面的访问权限！")])]):e._e(),"404"===e.errorCode?n("div",[n("img",{attrs:{src:r("3f77"),alt:""}}),n("p",{staticClass:"fs22"},[e._v("对不起，您所访问的页面不存在！")])]):e._e(),"500"===e.errorCode?n("div",[n("img",{attrs:{src:r("a61f"),alt:""}}),n("p",{staticClass:"fs22"},[e._v("服务器出错了，请联系管理员！")])]):e._e(),n("div",{staticClass:"clearfix  mt20"}),n("div",{staticClass:"btn-title ac"},[n("el-button",{attrs:{type:"success",size:"mini"},on:{click:e.goIndex}},[e._v("返回首页")])],1)])},p=[],f={name:"NotFound",props:{errorCode:String},data:function(){return{}},methods:{goIndex:function(){this.$router.push("/")}}},m=f,g=Object(i["a"])(m,d,p,!1,null,null,null),h=g.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-container",[r("el-main",{staticStyle:{height:"calc(100% - 50px)"}},[r("el-row",{attrs:{type:"flex",gutter:20,justify:"center"}},[r("el-col",{staticClass:"login-aside",attrs:{span:8}}),r("el-col",{attrs:{span:8}},[r("el-form",{ref:"loginForm",staticStyle:{"padding-top":"20px"},attrs:{rules:e.loginRules,model:e.loginData,"label-width":"80px"}},[r("el-form-item",{staticStyle:{"text-align":"center"}},[r("span",{staticStyle:{color:"#cbced5","font-size":"large"}},[e._v("天源迪科/技术支撑中心/统一认证平台")])]),r("el-form-item",{attrs:{prop:"loginAcct"}},[r("el-input",{attrs:{placeholder:"请输入用户名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm("loginForm")}},model:{value:e.loginData.loginAcct,callback:function(t){e.$set(e.loginData,"loginAcct",t)},expression:"loginData.loginAcct"}},[r("template",{slot:"prepend"},[e._v("用户")])],2)],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入密码",autocomplete:"off"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm("loginForm")}},model:{value:e.loginData.password,callback:function(t){e.$set(e.loginData,"password",t)},expression:"loginData.password"}},[r("template",{slot:"prepend"},[e._v("密码")])],2)],1),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",disabled:e.loginButtonDisable},on:{click:function(t){return e.submitForm("loginForm")}}},[e._v("登录")])],1)],1)],1),r("el-col",{staticClass:"login-aside",attrs:{span:8}})],1)],1)],1)],1)},v=[],E=r("bc3a"),y=r.n(E),S=r("5c96"),b=r.n(S),I=r("2f62"),k={token:null,accessToken:null,principal:null},C=(r("4917"),r("a481"),r("96cf"),r("3b8d")),w=r("d225"),O=r("b0b4"),N=r("db49"),D=r.n(N),A=function(){function e(){Object(w["a"])(this,e)}return Object(O["a"])(e,[{key:"getJwtToken",value:function(e){return W.request({url:"/authorization/token",method:"get",params:{code:e}})}},{key:"getUser",value:function(){return W.request({url:"/authorization/user",method:"get"})}},{key:"singleSign",value:function(e){return W.request({url:"/ssoAuthorize/exchange",method:"get",params:e})}}]),e}(),T=new A,P=T,R={auth:P},x={INDEX_URL:"/index",INDEX_CODE:"SYS_INDEX",TOKEN_KEY:"JWT-TOKEN",ACCESS_TOKEN_KEY:"OAUTH2-ACCESS-TOKEN",ROLES_KEY:"USER-ROLES",USER_KEY:"LOGIN-USER",USER_PERMISSIONS_KEY:"USER-PERMISSIONS",RESOURCES_KEY:"USER-RESOURCES",PRINCIPAL_KEY:"LOGIN-PRINCIPAL",PAGE_SIZE:10,PAGE_LIST:[10,20,50,100],state:{VALID:"10A",INVALID:"10X"},authCode:{demo:{DEMO_BTN_ADD:"DEMO_BTN_ADD"}},RESP_CODE_SUCESS:"200"},L=x,K=(r("3b2b"),r("ac6a"),r("28a5"),function(){window.location.href=D.a.authorization.authenticationUrl+"?client_id="+D.a.authorization.clientId+"&response_type=code&redirect_uri="+D.a.authorization.indexPage}),U={getItem:function(e){return localStorage.getItem(e)},setItem:function(e,t){localStorage.setItem(e,t)},removeItem:function(e){localStorage.removeItem(e)}},q=function(e,t,r){r.forEach(function(e){delete e.children});var n={};r.forEach(function(t){n[t[e]]=t});var o=[];return r.forEach(function(e){var r=n[e[t]];r?(r.children||(r.children=[])).push(e):o.push(e)}),o},Y={initJwtToken:function(){var e=Object(C["a"])(regeneratorRuntime.mark(function e(t,r){var n,o,a,i,s,c,u,l,d,p;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,o=t.dispatch,t.state,a=r.code,e.next=4,R.auth.getJwtToken(a);case 4:return i=e.sent,void 0===i&&o("logout"),s=i.data,c=s.code,u=s.data,L.RESP_CODE_SUCESS!==c&&alert("接口异常"),l=u.jwtToken,d=u.accessToken,n("setToken",{token:l}),n("setAccessToken",{accessToken:d}),e.next=13,R.auth.getUser();case 13:return p=e.sent,e.abrupt("return",p);case 15:case"end":return e.stop()}},e)}));function t(t,r){return e.apply(this,arguments)}return t}(),setPrincipal:function(e,t){var r=e.commit,n=t.data,o=n.code,a=n.data;L.RESP_CODE_SUCESS!==o&&alert("接口异常"),r("setPrincipal",{principal:a})},logout:function(e){var t=e.commit;t("clearSession"),K()},singleSign:function(e,t){var r=t.path,n=/^sso:.+:\/\/\/.+/;return new Promise(function(t,o){if(n.test(r)){var a=r.replace(/^sso:.+:\/\//,""),i=r.match(/^sso:(\S*):\/\//)[1],s={access_token_value:e.getters["accessToken"],response_type:D.a.authorization.responseType,scope:D.a.authorization.scope,state:D.a.authorization.state,client_id:i};R.auth.singleSign(s).then(function(e){if(e&&e.data&&"200"===e.data.code){var r=e.data.data.code,n=e.data.data.redirectUris,i=n[1]||n[0];i||o(new Error("目标系统未配置首页地址!")),t({code:r,targetUrl:"".concat(i).concat(a)})}else o(new Error("单点失败,请联系管理员!"))})}else o(new Error("单点地址格式错误!"))})},linkTo:function(e,t){var r=t.path,n=t.callback;if(!r)return!1;/^sso:.*?:\/\//.test(r)?e.dispatch("singleSign",{path:r}).then(function(e){"function"===typeof n?n(e.targetUrl,e.code):window.open("".concat(e.targetUrl).concat(/\?\S+=/.test(e.targetUrl)?"&":"?","code=").concat(e.code))}):ie.push(r)}},j={setToken:function(e,t){U.setItem(L.TOKEN_KEY,t.token),e.token=t.token},setAccessToken:function(e,t){U.setItem(L.ACCESS_TOKEN_KEY,t.accessToken),e.accessToken=t.accessToken},setPrincipal:function(e,t){U.setItem(L.PRINCIPAL_KEY,JSON.stringify(t.principal)),e.principal=t.principal},clearSession:function(e){U.removeItem(L.PRINCIPAL_KEY),U.removeItem(L.TOKEN_KEY),U.removeItem(L.ACCESS_TOKEN_KEY),e.principal=null,e.roles=null,e.accessToken=null}},z={menuTree:function(e){var t=e.principal||JSON.parse(U.getItem(L.PRINCIPAL_KEY));return t?null===t.menus?null:q("id","parent",t.menus.filter(function(e){return e.parent!==D.a.system.menuRoot})):{}},user:function(e){var t=e.principal||JSON.parse(U.getItem(L.PRINCIPAL_KEY));if(null===t)return{};var r=t.userId,n=t.loginAcct,o=t.username,a=t.mobile;return{userId:r,loginAcct:n,username:o,mobile:a}},indexPage:function(e){var t=e.principal||JSON.parse(U.getItem(L.PRINCIPAL_KEY));if(null===t)return"/";var r=t.menus.filter(function(e){return e.url});return r.length>0?r[0].url:"/"},hasPermission:function(e){return function(t){var r=e.principal||JSON.parse(U.getItem(L.PRINCIPAL_KEY));if(null!==r){var n=r.elements.filter(function(e){return e.privilegeCode===t});return n.length>0}return!1}},hasRouterPermission:function(e){return function(t){var r=e.principal||JSON.parse(U.getItem(L.PRINCIPAL_KEY));if(null===r)return!1;var n=r.menus.filter(function(e){return e.url===t});return n.length>0}},accessToken:function(e){return U.getItem(L.ACCESS_TOKEN_KEY)}},B={namespaced:!0,state:k,getters:z,actions:Y,mutations:j},F={demoList:[{date:"2016-05-02",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"},{date:"2016-05-04",name:"王小虎",address:"上海市普陀区金沙江路 1517 弄"},{date:"2016-05-01",name:"王小虎",address:"上海市普陀区金沙江路 1519 弄"},{date:"2016-05-03",name:"王小虎",address:"上海市普陀区金沙江路 1516 弄"}],demo:null},J=(r("7f7f"),{queryDemoList:function(e){var t=e.id,r=e.name,n=e.age,o=e.birthday,a=e.pageNum,i=e.pageSize;return W.request({url:"/temp/demo",method:"get",params:{id:t,name:r,age:n,birthday:o,pageNum:a,pageSize:i}})},addDemo:function(e){var t=e.id,r=e.name,n=e.age,o=e.birthdate;return W.request({url:"/temp/demo",method:"post",params:{id:t,name:r,age:n,birthdate:o}})},getDemoById:function(e){return W.request({url:"/temp/demo/"+e,method:"get"})},updateDemo:function(e){var t=e.id,r=e.name,n=e.age,o=e.birthdate;return W.request({url:"/temp/demo",method:"put",params:{id:t,name:r,age:n,birthdate:o}})},deleteDemo:function(e){return W.request({url:"/temp/demo/"+e,method:"delete"})}}),M={loadDemoList:function(e,t){var r=e.commit,n=t.id,o=t.name,a=t.age,i=t.birthday;J.queryDemoList({id:n,name:o,age:a,birthday:i}).then(function(e){r("setDemoList",{demoList:e.data.data})})}},$={setDemoList:function(e,t){e.demoList=t.demoList}},X={getDemoList:function(e){return e.demoList}},G={namespaced:!0,state:F,getters:X,actions:M,mutations:$};n["default"].use(I["a"]);var H=new I["a"].Store({modules:{auth:B,demo:G}}),V=y.a.create({headers:{x_requested_with:"XMLHttpRequest"}});function Z(e){H.dispatch("auth/logout").then(function(){S["Notification"].error({title:"提示",message:e})}).catch(function(e){console.error(e)})}V.interceptors.request.use(function(e){return U.getItem(L.TOKEN_KEY)&&(e.headers.Authorization=U.getItem(L.TOKEN_KEY)),e.url="/sso-service"+e.url,e},function(e){return Promise.reject(e)}),V.interceptors.response.use(function(e){switch(e.data.code){case"200":return e;case"401":S["Notification"].error({title:"提示",message:e.data.message});break;case"403":S["Notification"].error({title:"提示",message:e.data.message});break;case"500":S["Notification"].error({title:"提示",message:e.data.message});break;default:return e}},function(e){if(console.error(e),500!==e.response.status)return Promise.reject(e.response);var t=e.response.data;if(null!==t&&void 0!==t){var r=t.code,n=t.message;"401"===r&&Z(n)}else S["Notification"].error({title:"提示",message:e.response.data.message})});var W=V,Q={login:function(e){var t=e.client_id,r=e.loginAcct,n=e.password,o=e.redirect_uri,a=e.response_type,i=e.scopes,s=e.state;return W.request({url:"/oauth/authorize",method:"post",params:{client_id:t,loginAcct:r,password:n,redirect_uri:o,response_type:a,scopes:i,state:s}})}},ee={name:"login",props:{client_id:String,redirect_uri:String,response_type:String,state:String},data:function(){return{loginButtonDisable:!0,loginData:{loginAcct:"",password:"",client_id:this.client_id?this.client_id:"BB9E309C9FA6426FB7C9F0C3D3883940",redirect_uri:this.redirect_uri?this.redirect_uri:"http://192.168.129.44:8000/web-cmdb",response_type:this.response_type?this.response_type:"code",scopes:"",state:this.state?this.state:"ANY"},loginRules:{password:[{required:!0,message:"请输入密码",trigger:"blur"}],loginAcct:[{required:!0,message:"请输入账号",trigger:"blur"}]}}},mounted:function(){var e=[];this.loginData.client_id||e.push("client_id"),this.loginData.redirect_uri||e.push("redirect_uri"),this.loginData.response_type||e.push("response_type"),this.loginButtonDisable=e.length>0,this.loginButtonDisable&&this.$message({showClose:!0,message:"门户未配置，请完善URL中目标系统".concat(e.join(","),"参数信息"),type:"error"})},methods:{submitForm:function(e){var t=this;this.loginButtonDisable||this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t.loginData.redirect_uri=decodeURIComponent(t.loginData.redirect_uri),Q.login(t.loginData).then(function(e){e&&"200"===e.data.code&&(window.location.href="".concat(t.loginData.redirect_uri,"?code=").concat(e.data.data))})})}}},te=ee,re=(r("3ccf"),Object(i["a"])(te,_,v,!1,null,"d7ecf850",null)),ne=re.exports;n["default"].use(l["a"]);var oe={home:"/"},ae=new l["a"]({mode:"hash",routes:[{path:oe.home,name:"home",props:function(e){return{client_id:e.query.client_id,redirect_uri:e.query.redirect_uri,response_type:e.query.response_type,state:e.query.state}},component:ne},{path:"/auth/error",name:"Error",props:function(e){return{errorCode:e.query.errorCode}},component:h}]});ae.beforeEach(function(e,t,r){var n=200,o=!1;for(var a in oe)if(oe[a]===e.path){o=!0;break}o||(n=404),200===n?r():r("/auth/error?errorCode="+n)});var ie=ae;r("0fae");r.e("chunk-76d1ddf1").then(r.t.bind(null,"0789",7)),n["default"].use(b.a),n["default"].config.productionTip=!1,new n["default"]({router:ie,store:H,render:function(e){return e(u)}}).$mount("#app")},"64a9":function(e,t,r){},a61f:function(e,t,r){e.exports=r.p+"img/icon_500.0016faae.png"},db49:function(e,t){e.exports={deploy:{requestBaseUrl:"http://60.173.195.121:9906/ez-gateway/authentication-center-service"},service:{baseInterfaceUrl:"/sso-service"},authorization:{authenticationUrl:"http://134.64.116.90:9021/eam-apps/oauth/authorize",clientId:"CTAHZSX20190617",indexPage:"http://134.95.28.25:9900/web-gec",responseType:"code",scope:"ALL",state:"ANY"},system:{menuRoot:"10"}}}});
//# sourceMappingURL=app.6eee435c.js.map