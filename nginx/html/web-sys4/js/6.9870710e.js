(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"0317":function(e,t,a){},"5WNf":function(e,t,a){"use strict";var r=a("fWYu"),o=a.n(r);o.a},"6FMO":function(e,t,a){var r=a("0/R4"),o=a("EWmC"),n=a("K0xU")("species");e.exports=function(e){var t;return o(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!o(t.prototype)||(t=void 0),r(t)&&(t=t[n],null===t&&(t=void 0))),void 0===t?Array:t}},CkkT:function(e,t,a){var r=a("m0Pp"),o=a("Ymqv"),n=a("S/j/"),s=a("ne8i"),i=a("zRwo");e.exports=function(e,t){var a=1==e,l=2==e,c=3==e,f=4==e,d=6==e,u=5==e||d,m=t||i;return function(t,i,p){for(var h,g,b=n(t),v=o(b),w=r(i,p,3),y=s(v.length),x=0,F=a?m(t,y):l?m(t,0):void 0;y>x;x++)if((u||x in v)&&(h=v[x],g=w(h,x,b),e))if(a)F[x]=g;else if(g)switch(e){case 3:return!0;case 5:return h;case 6:return x;case 2:F.push(h)}else if(f)return!1;return d?-1:c||f?f:F}}},EWmC:function(e,t,a){var r=a("LZWt");e.exports=Array.isArray||function(e){return"Array"==r(e)}},FGQz:function(e,t,a){},HITl:function(e,t,a){"use strict";var r=a("0317"),o=a.n(r);o.a},INYr:function(e,t,a){"use strict";var r=a("XKFU"),o=a("CkkT")(6),n="findIndex",s=!0;n in[]&&Array(1)[n](function(){s=!1}),r(r.P+r.F*s,"Array",{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),a("nGyu")(n)},OADL:function(e,t,a){"use strict";var r=a("FGQz"),o=a.n(r);o.a},bcRT:function(e,t,a){},fWYu:function(e,t,a){},jMlT:function(e,t,a){"use strict";var r=a("bcRT"),o=a.n(r);o.a},"n+In":function(e,t,a){"use strict";var r=a("ql+E"),o=a.n(r);o.a},"ql+E":function(e,t,a){},tQXy:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticStyle:{"margin-top":"-10px"}},[a("el-main",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"always"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("员工管理")])]),a("staff-tree",{ref:e.refs.tree,attrs:{showActionButton:!0},on:{clickNode:e.clickNode,addStaff:e.addStaff}})],1)],1),a("el-col",{attrs:{span:16}},[a("staff-table",{ref:e.refs.table,attrs:{show:e.tableForm.show,"table-form":e.tableForm,selects:e.selects},on:{"update:show":function(t){e.$set(e.tableForm,"show",t)},editStaff:e.editStaff}})],1),a("el-col",{staticStyle:{"margin-top":"10px"},attrs:{span:24}},[a("staff-dialog",{ref:e.refs.dialog,attrs:{selects:e.selects,"dialog-form":e.dialogForm},on:{closeDialog:e.closeDialog}})],1)],1)],1)],1)},o=[],n=(a("rGqo"),a("yt8O"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-row",{staticClass:"filter-query"},[a("el-col",{attrs:{span:6}},[a("span",{staticClass:"filter-span"},[e._v("组织名称")])]),a("el-col",{attrs:{span:12,offset:1}},[a("el-input",{attrs:{placeholder:"组织机构"},model:{value:e.orgFilter,callback:function(t){e.orgFilter=t},expression:"orgFilter"}})],1)],1),a("el-tree",{ref:e.ref,attrs:{data:e.treeData,"node-key":"orgId",accordion:"","show-checkbox":!1,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(o.orgName))]),e.showActionButton&&r.isLeaf&&1!==r.level?a("span",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addStaff(t,o,r)}}},[e._v("新增员工")])],1):e._e()])}}])})],1)}),s=[],i=(a("ls82"),a("MECJ")),l=(a("VRzm"),a("Mlzr")),c={name:"StaffTree",props:{showActionButton:{type:Boolean,require:!1,default:!1}},data:function(){return{ref:"tree",loading:!1,orgFilter:"",treeData:[]}},created:function(){this.initTreeNodes()},watch:{orgFilter:function(e,t){this.$refs[this.ref].filter(e)}},methods:{initTreeNodes:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.treeData=[],this.loading=!0,e.next=4,this.$api.staffs.getOrganizationList();case 4:t=e.sent,this.loading=!1,this.treeData=Object(l["c"])("orgId","parentOrgId",t.data.data);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),filterNode:function(e,t){return!e||-1!==t.orgName.indexOf(e)},addStaff:function(e,t,a){this.$emit("addStaff",e,t,a)},clickNode:function(e,t,a){this.$emit("clickNode",e,t,a)}}},f=c,d=(a("OADL"),a("KHd+")),u=Object(d["a"])(f,n,s,!1,null,null,null),m=u.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{directives:[{name:"show",rawName:"v-show",value:!0===e.show,expression:"show === true"}],attrs:{shadow:"always"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("员工信息")])]),a("el-form",{attrs:{inline:!0,model:e.searchForm}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"查询"}},[a("el-input",{attrs:{placeholder:"工号/姓名模糊查询"},model:{value:e.searchForm.fuzzyQuery,callback:function(t){e.$set(e.searchForm,"fuzzyQuery",t)},expression:"searchForm.fuzzyQuery"}})],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.search,expression:"loading.search"}],attrs:{type:"primary"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),a("el-col",{attrs:{span:24}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.table,expression:"loading.table"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":"",border:""}},[a("el-table-column",{attrs:{prop:"staffId",label:"员工id","show-tooltip-when-overflow":""}}),a("el-table-column",{attrs:{prop:"staffAccount",label:"工号","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"staffName",label:"姓名","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"postCode","min-width":"120px",label:"岗位","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.postCodeFormat(t.row.postCode)))])]}}])}),a("el-table-column",{attrs:{prop:"mobile","min-width":"150px",label:"手机","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"email","min-width":"200px",label:"邮箱","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"initRoleId","min-width":"150px",label:"是否创建账号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.staffIdFormat(t.row.initRoleId)))])]}}])}),a("el-table-column",{attrs:{fixed:"right","min-width":"200px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.editStaff(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.deleteStaff(t.row)}}},[e._v("删除")]),a("staff-popover",{attrs:{"dialog-form":t.row},on:{editStaffOrg:e.editStaffOrg}})]}}])})],1),a("div",{staticClass:"el-row ac mt20"},[a("el-pagination",{attrs:{"page-size":10,"page-sizes":[10,20,30],"current-page":e.searchForm.pageNum||1,background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.tableTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)],1)},h=[],g=(a("INYr"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",{attrs:{placement:"left",width:"400",trigger:"click"}},[a("el-tree",{ref:"popoverTree",attrs:{data:e.treeData,"node-key":"orgId",accordion:"","show-checkbox":!1,"highlight-current":!0,"expand-on-click-node":!0},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(o.orgName))]),r.isLeaf&&1!==r.level&&o.orgId!==e.dialogForm.orgId?a("span",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.editStaffOrg(t,o,r)}}},[e._v("更改")])],1):e._e()])}}])}),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("调整组织")])],1)}),b=[],v={name:"staffPopover",props:["dialogForm"],data:function(){return{treeData:[]}},created:function(){this.initTreeNodes()},methods:{initTreeNodes:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.treeData=[],e.next=3,this.$api.staffs.getOrganizationList();case 3:t=e.sent,this.treeData=Object(l["c"])("orgId","parentOrgId",t.data.data);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),clickNode:function(){},editStaffOrg:function(e,t,a){var r=this;this.$confirm("此操作将修改员工【".concat(this.dialogForm.staffName,"】的组织，是否继续？"),"取消",{type:"warning"}).then(function(){r.$emit("editStaffOrg",t.orgId,r.dialogForm)})}}},w=v,y=(a("HITl"),Object(d["a"])(w,g,b,!1,null,"0a3e9cb6",null)),x=y.exports,F={name:"StaffForm",components:{"staff-popover":x},props:["show","tableForm","selects"],data:function(){return{border:!0,loading:{search:!1,table:!1},searchForm:{fuzzyQuery:"",orgId:"",pageSize:10,pageNum:1},tableData:[],tableTotal:0}},watch:{"tableForm.orgId":function(e,t){this.searchForm.fuzzyQuery="",this.searchForm.orgId=e,this.searchForm.pageSize=10,this.searchForm.pageNum=1,this.initTable(this.searchForm)}},methods:{initTable:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading.table=!0,e.next=3,this.$api.staffs.getStaffList(t);case 3:a=e.sent,this.loading.table=!1,this.tableData=a.data.data,this.tableTotal=this.tableData?this.tableData.length:0;case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),handleSizeChange:function(){},handleCurrentChange:function(){},handleQuery:function(){this.initTable(this.searchForm)},postCodeFormat:function(e){var t=this.selects.postCodeArr.findIndex(function(t){return t.value===e});return-1!==t?this.selects.postCodeArr[t].label:""},staffIdFormat:function(e){return e?"是":"否"},editStaff:function(e){this.$emit("editStaff",e)},editStaffOrg:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,a){var r,o,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(o in r={remark:"",email:"",gender:"",initRoleId:"",mobile:"",orgId:"",postCode:"",staffAccount:"",staffId:"",staffName:""},r)r[o]="orgId"===o?t:a[o]?a[o]:"";return e.next=4,this.$api.staffs.editStaff(r);case 4:n=e.sent,this.$message({showClose:!0,message:n.data.meta.message,type:n.data.meta.success?"success":"error"}),this.initTable(this.searchForm);case 7:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),deleteStaff:function(e){var t=this;this.$confirm("此操作将删除员工【".concat(e.staffName,"】，是否继续？"),"删除",{type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$api.staffs.deleteStaff(e.staffId);case 2:r=a.sent,t.$message({showClose:!0,message:r.data.meta.message,type:r.data.meta.success?"success":"error"}),t.initTable(t.searchForm);case 5:case"end":return a.stop()}},a,this)})))}}},k=F,I=(a("n+In"),Object(d["a"])(k,p,h,!1,null,null,null)),S=I.exports,A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"dialog",attrs:{title:e.dialog.title,visible:e.dialog.visible,fullscreen:!0,width:"80%"},on:{"update:visible":function(t){e.$set(e.dialog,"visible",t)},close:e.close,open:e.afterOpen}},[a("el-form",{ref:"dialogForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工号",prop:"staffAccount"}},[a("el-input",{attrs:{placeholder:"请输入工号"},model:{value:e.form.staffAccount,callback:function(t){e.$set(e.form,"staffAccount",t)},expression:"form.staffAccount"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"staffName"}},[a("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.form.staffName,callback:function(t){e.$set(e.form,"staffName",t)},expression:"form.staffName"}})],1),a("el-form-item",{attrs:{label:"岗位",prop:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择岗位"},model:{value:e.form.postCode,callback:function(t){e.$set(e.form,"postCode",t)},expression:"form.postCode"}},e._l(e.selects.postCodeArr,function(e){return a("el-option",{key:e.id,attrs:{value:e.value,label:e.label}})}))],1),a("el-form-item",{attrs:{label:"性别",prop:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择性别"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},e._l(e.selects.genderArr,function(e){return a("el-option",{key:e.id,attrs:{value:e.value,label:e.label}})}))],1),a("el-form-item",{attrs:{label:"手机",prop:""}},[a("el-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:""}},[a("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"备注",prop:""}},[a("el-input",{attrs:{type:"textarea",placeholder:"备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.dialog.isAdd,expression:"dialog.isAdd"}]},[a("el-form-item",{attrs:{label:"",prop:""}},[a("el-checkbox",{model:{value:e.createRoleFlag,callback:function(t){e.createRoleFlag=t},expression:"createRoleFlag"}},[e._v("是否创建账号")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.createRoleFlag,expression:"createRoleFlag"}],attrs:{label:"角色",prop:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择角色"},model:{value:e.form.initRoleId,callback:function(t){e.$set(e.form,"initRoleId",t)},expression:"form.initRoleId"}},e._l(e.selects.roleArr,function(e){return a("el-option",{key:e.roleId,attrs:{value:e.roleId,label:e.roleName}})}))],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]),a("el-button",{on:{click:e.reset}},[e._v("重置")])],1)],1)],1)],1)],1)},N=[];function O(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var _={name:"StaffDialog",props:{dialogForm:{type:Object,default:{}},selects:{type:Object,default:{}}},created:function(){},data:function(){return{createRoleFlag:!1,dialog:{title:"",isAdd:!1,visible:!1},form:{remark:"",email:"",gender:"",initRoleId:"",mobile:"",orgId:"",postCode:"",staffAccount:"",staffId:"",staffName:""},rules:{staffName:[{required:!0,message:"姓名不能为空",trigger:"blur"}],staffAccount:[{required:!0,message:"工号不能为空",trigger:"blur"}]}}},methods:{showAddStaffDialog:function(){this.dialog.title="新增员工",this.dialog.isAdd=!0,this.dialog.visible=!0},showEditStaffDialog:function(){this.dialog.title="修改员工",this.dialog.isAdd=!1,this.dialog.visible=!0},onSubmit:function(){var e=this;this.$refs.dialogForm.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(a){var r,o,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=7;break}return r=e.form,r.staffId,o=O(r,["staffId"]),t.next=4,e.dialog.isAdd?e.$api.staffs.addStaff(o):e.$api.staffs.editStaff(e.form);case 4:n=t.sent,e.$message({showClose:!0,message:n.data.meta.message,type:n.data.meta.success?"success":"error"}),n.data.meta.success&&e.close();case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}())},reset:function(){for(var e in this.form)"orgId"!==e&&"staffId"!==e&&(this.form[e]="")},close:function(){this.dialog.visible=!1,this.$emit("closeDialog")},afterOpen:function(){}},watch:{dialogForm:{deep:!0,immediate:!0,handler:function(e,t){for(var a in this.createRoleFlag=!!e.initRoleId,e.orgId&&""!==e.staffId?this.showEditStaffDialog():e.orgId&&""===e.staffId&&this.showAddStaffDialog(),e)this.form[a]=e[a]}}}},$=_,R=(a("5WNf"),Object(d["a"])($,A,N,!1,null,null,null)),C=R.exports,z={name:"StaffSection",components:{"staff-table":S,"staff-tree":m,"staff-dialog":C},data:function(){return{refs:{tree:"tree",table:"table",dialog:"dialog"},tableForm:{show:!1,fuzzyQuery:"",orgId:""},dialogForm:{remark:"",email:"",gender:"",initRoleId:"",mobile:"",orgId:"",postCode:"",staffAccount:"",staffId:"",staffName:""},selects:{roleArr:[],genderArr:[],postCodeArr:[]}}},methods:{resetDialogForm:function(){this.dialogForm={remark:"",email:"",gender:"",initRoleId:"",mobile:"",orgId:"",postCode:"",staffAccount:"",staffId:"",staffName:""}},addStaff:function(e,t,a){e.stopPropagation(),this.resetDialogForm(),this.dialogForm.orgId=t.orgId},editStaff:function(e){for(var t in this.resetDialogForm(),this.dialogForm)this.dialogForm[t]=e[t]?e[t]:""},closeDialog:function(){this.resetDialogForm(),this.$refs[this.refs.table].handleQuery()},clickNode:function(e,t,a){t.isLeaf&&1!==t.level&&(this.tableForm.show=!0,this.tableForm.orgId=e.orgId,this.tableForm.fuzzyQuery="")}},created:function(){var e=this;Promise.all([this.$api.roles.getRoleByPage(1e3,1,null),this.$api.staffs.getDic("STAFF","GENGER"),this.$api.staffs.getDic("STAFF","POST_TYPE")]).then(function(t){e.selects.roleArr=t[0].data.data.list,e.selects.genderArr=t[1].data.data,e.selects.postCodeArr=t[2].data.data})}},D=z,T=(a("jMlT"),Object(d["a"])(D,r,o,!1,null,"40afdf9b",null));t["default"]=T.exports},zRwo:function(e,t,a){var r=a("6FMO");e.exports=function(e,t){return new(r(e))(t)}}}]);
//# sourceMappingURL=6.9870710e.js.map