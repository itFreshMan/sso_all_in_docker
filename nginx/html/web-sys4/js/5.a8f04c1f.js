(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"7YsS":function(e,t,r){},"8hgZ":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.showActionButton?r("el-row",{staticStyle:{"margin-bottom":"20px"}},[r("el-col",{attrs:{span:6}},[r("span",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("数据权限名称")])]),r("el-col",{attrs:{span:10,offset:1}},[r("el-input",{attrs:{placeholder:"数据权限"},model:{value:e.privilegeFilter,callback:function(t){e.privilegeFilter=t},expression:"privilegeFilter"}})],1),r("el-col",{staticStyle:{height:"40px","line-height":"40px"},attrs:{span:4,offset:1}},[r("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.add(t)}}},[e._v("新增")])],1)],1):e._e(),r("el-tree",{ref:e.ref,attrs:{data:e.tree.data,"node-key":"id",accordion:"",lazy:!0,load:e.asyncLoadTreeNode,"filter-node-method":e.filterNode,props:e.tree.defaultProps,"show-checkbox":!1,"highlight-current":!0,"expand-on-click-node":!1},on:{"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",[e._v(e._s(a.name))]),e.showActionButton?r("span",[r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.add(t,a,n)}}},[e._v("新增")]),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.edit(t,a,n)}}},[e._v("修改")]),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.remove(t,a,n)}}},[e._v("删除")])],1):e._e()])}}])})],1)},a=[],i=(r("f3/d"),r("rGqo"),r("ls82"),r("MECJ")),o=(r("VRzm"),{name:"privilegeTree",props:{showActionButton:{type:Boolean,require:!1,default:!1}},data:function(){return{ref:"tree",privilegeFilter:"",tree:{data:[],defaultProps:{isLeaf:"leaf"}}}},watch:{privilegeFilter:function(e,t){this.$refs[this.ref].filter(e)}},methods:{asyncLoadTreeNode:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r){var n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0===t.level){e.next=7;break}return n=[],e.next=4,this.$api.privileges.gerPrivilegeList(t.data.id,"");case 4:a=e.sent,a.data.data&&a.data.data.forEach(function(e){n.push({id:e.id,code:e.code,name:e.name,parentId:e.parentId,path:e.path,leaf:0===e.childCount})}),r(n);case 7:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),initTreeNodes:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tree.data=[],console.log("dataId",this.dataId),e.next=4,this.$api.privileges.gerPrivilege(this.dataId);case 4:t=e.sent,t.data.data&&this.tree.data.push({id:t.data.data.id,code:t.data.data.code,name:t.data.data.name,parentId:t.data.data.parentId,path:t.data.data.path,leaf:0===t.data.data.childCount});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},add:function(e,t,r){this.$emit("add",e,t,r)},edit:function(e,t,r){this.$emit("edit",e,t,r)},remove:function(e,t,r){this.$emit("remove",e,t,r)},clickNode:function(e,t,r){this.$emit("clickNode",e,t,r)},getCheckedNodes:function(){return this.$refs[this.ref].getCheckedNodes()},getElementTreeRef:function(){return this.$refs[this.ref]}},computed:{dataId:function(){return""===localStorage.getItem("dataId")?"-1":localStorage.getItem("dataId")}},mounted:function(){this.initTreeNodes()}}),s=o,c=(r("EI4X"),r("KHd+")),d=Object(c["a"])(s,n,a,!1,null,null,null);t["a"]=d.exports},BBmF:function(e,t,r){},EI4X:function(e,t,r){"use strict";var n=r("7YsS"),a=r.n(n);a.a},FPRq:function(e,t,r){},MpDJ:function(e,t,r){"use strict";var n=r("BBmF"),a=r.n(n);a.a},"f3/d":function(e,t,r){var n=r("hswa").f,a=Function.prototype,i=/^\s*function ([^ (]*)/,o="name";o in a||r("nh4g")&&n(a,o,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(e){return""}}})},"fFT+":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticStyle:{"margin-top":"-10px"}},[r("el-main",[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:10}},[r("el-card",{attrs:{shadow:"always"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("数据权限")])]),r("privilege-tree",{ref:e.refs.tree,attrs:{"show-action-button":!0},on:{clickNode:e.clickNode,add:e.add,edit:e.edit,remove:e.remove}})],1)],1),r("el-col",{attrs:{span:14}},[r("privilege-form",{ref:e.refs.form,attrs:{content:e.form.content,action:e.form.action,disabled:e.form.disabled,show:e.form.show},on:{"update:show":function(t){e.$set(e.form,"show",t)},refreshTree:e.refreshTreeNode}})],1)],1)],1)],1)},a=[],i=(r("rGqo"),r("ls82"),r("MECJ")),o=(r("f3/d"),r("8hgZ")),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",{directives:[{name:"show",rawName:"v-show",value:!0===e.show,expression:"show === true"}],attrs:{shadow:"always"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("数据权限信息")])]),r("el-form",{ref:e.ref,attrs:{model:e.content,rules:e.rules,"label-width":"120px",disabled:e.disabled}},[r("el-form-item",{attrs:{label:"数据权限编码",prop:"code"}},[r("el-input",{attrs:{disabled:e.disabled},model:{value:e.content.code,callback:function(t){e.$set(e.content,"code",t)},expression:"content.code"}})],1),r("el-form-item",{attrs:{label:"数据权限名称",prop:"name"}},[r("el-input",{attrs:{disabled:e.disabled},model:{value:e.content.name,callback:function(t){e.$set(e.content,"name",t)},expression:"content.name"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]),r("el-button",{on:{click:e.cancelAction}},[e._v("取消")])],1)],1)],1)},c=[],d=(r("VRzm"),{name:"PrivilegeForm",props:["content","show","action","disabled"],data:function(){return{ref:"form",selects:[],rules:{code:[{required:!0,message:"请输入数据权限编码",trigger:"blur"}],name:[{required:!0,message:"请输入数据权限名称",trigger:"blur"}]}}},methods:{cancelAction:function(){this.$emit("update:show",!1)},onSubmit:function(){var e=this;this.$refs[this.ref].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(r){var n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=6;break}return n="add"==e.action,t.next=4,n?e.$api.privileges.addPrivilege(e.content):e.$api.privileges.editPrivilege(e.content);case 4:a=t.sent,a.data.meta&&a.data.meta.success?(e.$message({showClose:!0,message:a.data.meta.message,type:"success"}),e.$emit("refreshTree",e.content,n)):e.$message({dangerouslyUseHTMLString:!0,showClose:!0,message:a.data.meta.message,type:"error"});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}())}},watch:{action:function(e,t){this.$refs.form.resetFields()}}}),l=d,u=(r("qq9v"),r("KHd+")),f=Object(u["a"])(l,s,c,!1,null,"f3103564",null),h=f.exports,p={name:"privilegeSection",components:{"privilege-tree":o["a"],"privilege-form":h},data:function(){return{refs:{tree:"tree",form:"form"},form:{content:{},show:!1,disabled:!0,action:"detail"}}},methods:{clickNode:function(e,t,r){this.form.content={parentId:e.parentId,id:e.id,name:e.name,code:e.code,path:e.path},this.form.show=!0,this.form.disabled=!0,this.form.action="detail"},add:function(e,t,r){e.stopPropagation(),this.form.show=!0,this.form.disabled=!1,this.form.action="add",this.form.childCount=0,this.form.content={parentId:r?t.id:"-1",path:r?t.path:""}},edit:function(e,t,r){e.stopPropagation(),this.form.show=!0,this.form.disabled=!1,this.form.action="edit",this.form.content={parentId:t.parentId,id:t.id,name:t.name,code:t.code,path:t.path}},remove:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r,n){var a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.stopPropagation(),n.isLeaf){e.next=4;break}return this.$message({showClose:!0,message:"该节点下存在子节点，不允许删除！",type:"error"}),e.abrupt("return");case 4:this.$confirm("此操作将删除数据权限【".concat(r.name,"】，是否继续？"),"删除",{type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$api.privileges.deletePrivilege(r.id);case 2:t=e.sent,a.$message({showClose:!0,message:t.data.meta.message,type:t.data.meta.success?"success":"error"}),a.form.show=!1,a.refreshTreeNode(r,!0);case 6:case"end":return e.stop()}},e,this)})));case 5:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),refreshTreeNode:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,r){var n,a,i,o,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.form.disabled=!0,n=t.parentId,a=[],e.next=5,this.$api.privileges.gerPrivilegeList(n,"");case 5:if(i=e.sent,i.data.data&&i.data.data.forEach(function(e){a.push({id:e.id,code:e.code,name:e.name,parentId:e.parentId,path:e.path,leaf:0===e.childCount})}),-1!=n){e.next=10;break}return this.$refs[this.refs.tree].initTreeNodes(),e.abrupt("return",1);case 10:return o=n,s=this.$refs[this.refs.tree].getElementTreeRef().getNode(o),s.expand(),this.$refs[this.refs.tree].getElementTreeRef().updateKeyChildren(o,a),e.abrupt("return",1);case 15:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}},m=p,g=(r("MpDJ"),Object(u["a"])(m,n,a,!1,null,"5dec12cf",null));t["default"]=g.exports},qq9v:function(e,t,r){"use strict";var n=r("FPRq"),a=r.n(n);a.a}}]);
//# sourceMappingURL=5.a8f04c1f.js.map